# کوبرنتیز چیست؟
کوبرنتیز خودش یک کامپیوتر هستش که کلی node رو مدیریت میکند، زمانی که توسعه دهنده یک تغیر رو نهایی میکند تمامی عملیات Deploy رو خودش انجام میدهد. 

توسعه دهنده مشخص میکند که ساختار اپ چی هستش و کوبرنتیز بر روی Node ها پیاده سازی میکند.

همچنین برنامه نویس دقیقا مشخص میکند یک سری App ها باید کنار هم باشند و کوبرنتیز اون ها رو بروی یک Node پیاده سازی میکند و بقیه app هارو توی جاهای مختلف بر اساس نیاز کاربر قرار میدهد.
![[images/Kubernetes_deployment.png]]

# ساختار کوبرنتیز
همچنین Worker node ها همون Node هایی هستند که app ها بر روی آنها اجرا میشود.

![[images/kubernetes_structure.png]]

## بخش Control Plane
کوبرنتیز یک master node دارد که به اون میگیم Control Panel که وظیفه مدیریت کل Node هارو بر عهده دارد.
همچنین میتونیم یک master node داشته باشیم یا اینکه چندین مورد داشته باشیم که اطمینان رو بالاتر ببریم.

یک پل ارتباطی بین Control Plain و بقیه Worker ها وجود دارد به نام : 
Kubernetes API Server

توضیح `Scheduler`:
این بخش برای برنامه ریزی دپلوی برنامه مون هست که مشخص میکنه کدوم نود ها کدوم بخش های برنامه رو دپلوی رو انجام بدهند.

توضیح `Control Manager`:
این یک ابزاری هستش که بررسی میکند کانتینر ها مشکلی نداشته باشند و اگر `Fail` شدند اون ها رو احیا کند.
همچنین وظیفه replication بر عهده این بخش هستش.

توضیح `etcd`:
یک Data Store هست که کانفیگ های کلاستر رو توی خودش ذخیره میکند.

تمامی این موارد بخش هایی از Control Plane هستند که اپلیکیشن مارو اجرا نمیکنند و فقط وضعیت کلاستر رو بررسی میکند و عملیات Deploy رو انجام میدهد.
## بخش Worker node
این Worker ها ماشین هایی هستند که کانتینر هامون رو در خودشون نگه میدارن وظیفه این worker ها اجرا، مانیتور، **ارائه سرویس به کانتینر** رو دارد.

یکی از مسئولیت های مهم Worker Node همین **ارائه سرویس به کانتینر** هستش.

### Provide Services
توضیح `Provide Services`:
منظور این هست که  node فقط برنامه را اجرا نمیکند، بلکه زیر لازم برای دسترسی، ارتباط و عملکرد درست آن را فراهم میکند.

> در این بخش در حقیقت تمامی این عملیات برای Pod اتفاق می‌افتد برای درگیر نشدن ذهن مخاطب از واژه کانتینر استفاده شده است.

محیطی فراهم میکند که app ها اجرا شوند، به شبکه متصل شوند، داده ذخیره کنند و پایدار بماند و مانیتور شوند.

همچنین worker node برای کانتینر ها مثل یک میزبان در مهمانی هستند که فقط مهمان رو دعوت نمیکنند (Run container ) بلکه برایش غذا میزارد (Storage)، صندلی و فضا میدهد (Resources) و مطمعن میشود راحت هست (Health Checks ) پ بقیه مهمان هارو معرفی میکند( Networking )

حالا همه این هایی که مثال زدیم که بتونیم لایه لایه قشنگ تر توضیح بدیم:

بخش `Storage` : وظیفه این هستش که persistent volume هارو به کانتینر ها مونت میکند تا داده ها بعد از restart حفظ شود.

بخش `Networking`: با کمک ابزار `kube-proxy` و CNI (Container Interface Network) مسیر ارتباط پاد ها و سرویس ها را بر قرار میکند. 
> ابزار `kube-proxy` جلوتر کامل تر توضیح داده میشود

بخش `Monitoring`:  ابزار `kubelet` سلامت و وضعیت کانتینر هارو بررسی میکند و در صورت خرابی آنها رو بازسازی میکند.
> ابزار `kubelet` جلوتر کامل تر توضیح داده میشود

بخش `Resource management`: مصرف CPU و حافظه هر کانتینر رو طبق محدودیت اعمال شده کنترل میکند.

### Worker component 
- برای `Containter runtime‍` میتونیم از داکر ها هر چیز دیگه ای استفاده کنیم.
- با ابزار `kubelet` ارتباط با API Server ارتباط بر قرار میکند و برای مدیریت کانتینر های روی node استفاده میشود.
- ابزار `kube-proxy` یا `kubernetes Service Proxy` عملیات لود بالانس بین بخش های اپلیکیشن رو انجام میده.
تمامی این بخش ها جلوتر بصورت کامل تر توضیح داده میشود. فعلا هدف یادگیری نحو استفاده و دپلوی کردن اپلیکیشن مون هستش.


# اجرای اپلیکیشن بر روی کوبرنتیز
برای اجرای اپ روی کوبرنتیز اول باید پکیج مون رو داخل ریجیستری قرار بدهیم و به کوبرنتیز توضیحات اپ هامون رو بدیم.
باید بخش های برنامه مون رو مشخص کنیم که هر بخش چه کانتینری دارد و هر بخش با بخش دیگر چطور ارتباط دارد. همچنین آنهایی که باید Co-located باشند رو هم مشخص میکنیم منظور از این یعنی اون اپ هایی که باید روی Node مشترک اجرا شوند رو مشخص میکنیم. 
چیز هایی که میتوانیم مشخص کنیم:
-  هر بخش چند تا کپی دارد (Replicas)
-  اپ ها بصورت داخلی هستند یا external یعنی از بیرون دسترسی دارند یا خیر


![[images/Kubernetes_arch.png]]


نحو شناسایی بخش های پروژه کوبرنتیز:
حالا زمانی که توضیحات برنامه هامون رو درست کردیم از Kubernetes API اطلاعات رو مشخص میکنیم و به آن بخش های برنامه مون رو مشخص میکنیم.

از API اطلاعات رو پردازش میکند و scheduler برنامه ریزی میکند مجموعه ای از کانتینر هارو بر روی مجموعه ای از worker node ها قرار بدهد. 

مرحله بعدی `kubelet` روی node های مورد نظر با استفاده از Container Runtime مثل داکر image های مورد نظر رو pull میکند. حالا ما مجموعه ای از کانتینر هارو داریم که بهش میگیم pod.

ما باید به کوبرنتیز بفهمونیم کدوم کانتینر ها سرویس یکسانی دارند و همه آنها با یک IP Statis دسترس قرار میدهد.
