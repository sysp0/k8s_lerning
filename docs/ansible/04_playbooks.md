
# پلی بوک ها داخل انسیبل

## مقدمه و هدف

این داکیومنت یه توضیح کلی و سطح بالا از مفهوم پلی‌بوک توی انسیبل میده؛ یعنی قراره فقط دید بده که پلی‌بوک چیه و چطور ازش استفاده می‌کنیم، بدون اینکه بریم داخل ریز جزئیات.

## توضیح پلی‌بوک

پلی‌بوک یه فایل YAML هست که توش مشخص می‌کنیم چه کارهایی باید روی چه سرورهایی انجام بشه.  
یعنی خلاصه‌اش اینه: «چه عملیاتی، روی چه هاست‌هایی».

فرض کن می‌خوای یه‌سری کار پشت سر هم انجام بدی:

```
1 -> Ping
2 -> Config
3 -> Install
4 -> Test
5 -> Deploy
6 -> Delete
```

برای هر بخش از کار می‌تونیم یه پلی‌بوک جدا داشته باشیم. مثلاً توی پوشه playbook این فایل‌ها رو می‌ذاریم:

```
db.yml
default.yml
pre_install.yml
web.yml
example.yml
```

مثلاً توی `db.yml` کارهای مربوط به دیتابیس رو می‌نویسیم.  
یا توی `default.yml` چیزهایی که باید روی همه هاست‌ها اعمال بشه رو می‌ذاریم؛ بدون توجه به اینکه اون هاست چیه و توی چه گروهیه.

گاهی هم می‌خوایم همه پلی‌بوک‌ها رو از یه فایل اصلی اجرا کنیم. اونجا می‌تونیم یه فایل مثل `example.yml` داشته باشیم و بقیه پلی‌بوک‌ها رو داخلش import کنیم:

```yml
---
- import_playbook: default.yml
- import_playbook: web.yml
...
```

این‌ها همون ترتیب که نوشتی اجرا می‌شن.

## ساختار پلی‌بوک

ساختار کلی یه پلی‌بوک معمولاً این شکلیه:

```yml
- name: Web (install and config)
  hosts: web
  roles:
    - nginx
    - app
```

معنی‌اش اینه:  
روی گروه هاست‌های web بیا رول‌های `nginx` و `app` رو اجرا کن.  
(رول‌ها رو توی بخش بعد توضیح می‌دیم.)

در کل پلی‌بوک میگه: **کدوم Role روی کدوم Host اجرا بشه.**

## جمع‌بندی

پلی‌بوک‌ها حکم نقشهٔ عملیات توی انسیبل رو دارن؛ اینکه چه کاری، روی چه ماشینی، با چه ترتیبی انجام بشه. فایل‌ها می‌تونن جدا باشن، می‌تونن از یه فایل اصلی صدا زده بشن، و می‌تونن رول‌ها رو روی گروه‌های مختلف هاست اجرا کنن.  

## منابع
[دوره انسیبل مرتضی باشسیز](https://youtu.be/UmeRHa0Ihg0?si=akWaTKg4QRqaenVm)
